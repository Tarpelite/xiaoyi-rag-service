# xiaoyi-rag-service

ğŸ“š ç ”æŠ¥çŸ¥è¯†åº“æ£€ç´¢æœåŠ¡ - ä¸º xiaoyi æä¾›é«˜è´¨é‡çš„ç ”æŠ¥æ£€ç´¢èƒ½åŠ›

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- **PDF æ™ºèƒ½è§£æ**: åŸºäº MinerU å¤„ç†å¤æ‚å¸ƒå±€çš„é‡‘èç ”æŠ¥
- **æ··åˆæ£€ç´¢**: BM25 å…³é”®è¯ + å‘é‡è¯­ä¹‰æ£€ç´¢
- **é‡æ’åº**: BGE-Reranker ç²¾ç¡®æ’åº
- **å¢é‡ç´¢å¼•**: æ”¯æŒåŠ¨æ€æ·»åŠ /åˆ é™¤æ–‡æ¡£
- **RESTful API**: ç®€æ´çš„ HTTP æ¥å£ï¼Œæ˜“äºé›†æˆ

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FastAPI Server                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Search  â”‚  â”‚Documentsâ”‚  â”‚ Health  â”‚            â”‚
â”‚  â”‚  API    â”‚  â”‚   API   â”‚  â”‚  API    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚            â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚   Hybrid Retrieval   â”‚                         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚  â”‚  â”‚ BM25 â”‚ â”‚Vector â”‚  â”‚                         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚             â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚      Reranker        â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Storage: Qdrant (Vector) + SQLite (Metadata)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.11+
- Docker & Docker Compose
- NVIDIA GPU (æ¨è RTX 3090, ç”¨äº MinerU å’Œ Embedding)
- 64GB+ RAM (æ¨è)

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/your-org/xiaoyi-rag-service.git
cd xiaoyi-rag-service
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ Qdrant
docker-compose up -d qdrant

# å®‰è£…ä¾èµ–ï¼ˆåŸºç¡€ç‰ˆï¼Œä½¿ç”¨ PyMuPDF è§£æ PDFï¼‰
uv pip install -e .

# æˆ–è€…å®‰è£…å®Œæ•´ç‰ˆï¼ˆåŒ…å« MinerU é«˜è´¨é‡ PDF è§£æï¼‰
# æ³¨æ„ï¼šMinerU ä¾èµ–è¾ƒé‡ï¼Œéœ€è¦å…è®¸é¢„å‘å¸ƒç‰ˆæœ¬
uv pip install -e ".[mineru]" --prerelease=allow

# å¯åŠ¨ API æœåŠ¡
python -m src.main
```

### 3. æ„å»ºç´¢å¼•

```bash
# å°† PDF æ”¾å…¥ data/pdfs/ ç›®å½•ï¼Œç„¶åè¿è¡Œï¼š
python scripts/build_index.py --input data/pdfs --batch-size 10
```

### 4. æµ‹è¯•æ£€ç´¢

```bash
curl -X POST http://localhost:8000/api/v1/search \
  -H "Content-Type: application/json" \
  -d '{"query": "2024å¹´æ–°èƒ½æºè¡Œä¸šå±•æœ›", "top_k": 5}'
```

## ğŸ“– API æ–‡æ¡£

å¯åŠ¨æœåŠ¡åè®¿é—®: http://localhost:8000/docs

### æ ¸å¿ƒæ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/v1/search` | æ··åˆæ£€ç´¢ |
| POST | `/api/v1/documents` | ä¸Šä¼ å¹¶ç´¢å¼•æ–‡æ¡£ |
| GET | `/api/v1/documents/{doc_id}` | è·å–æ–‡æ¡£è¯¦æƒ… |
| DELETE | `/api/v1/documents/{doc_id}` | åˆ é™¤æ–‡æ¡£ |
| GET | `/api/v1/health` | å¥åº·æ£€æŸ¥ |

## âš™ï¸ é…ç½®

é€šè¿‡ç¯å¢ƒå˜é‡æˆ– `.env` æ–‡ä»¶é…ç½®ï¼š

```bash
# Qdrant
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_COLLECTION=reports

# Embedding
EMBEDDING_MODEL=BAAI/bge-large-zh-v1.5
EMBEDDING_DEVICE=cuda

# Reranker
RERANKER_MODEL=BAAI/bge-reranker-large
RERANKER_DEVICE=cuda

# æ£€ç´¢å‚æ•°
BM25_WEIGHT=0.3
VECTOR_WEIGHT=0.7
TOP_K_RETRIEVAL=100
TOP_K_RERANK=10
```

## ğŸ”§ å¼€å‘

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -e ".[dev]"

# è¿è¡Œæµ‹è¯•
pytest

# ä»£ç æ ¼å¼åŒ–
ruff format src tests
ruff check src tests
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
xiaoyi-rag-service/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py              # FastAPI å…¥å£
â”‚   â”œâ”€â”€ api/                  # API è·¯ç”±
â”‚   â”œâ”€â”€ indexing/             # ç´¢å¼•æ„å»º
â”‚   â”œâ”€â”€ retrieval/            # æ£€ç´¢é€»è¾‘
â”‚   â”œâ”€â”€ storage/              # å­˜å‚¨å±‚
â”‚   â””â”€â”€ models/               # Pydantic æ¨¡å‹
â”œâ”€â”€ scripts/                  # è¿ç»´è„šæœ¬
â”œâ”€â”€ data/                     # æ•°æ®ç›®å½•
â”œâ”€â”€ tests/                    # æµ‹è¯•
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ pyproject.toml
```

## ğŸ“„ License

MIT License
